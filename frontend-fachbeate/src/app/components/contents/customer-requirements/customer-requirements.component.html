<h1 class="h3">Anforderungen Technologische Unterstützung</h1>
<hr>

<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header  text-white bg-danger">Anforderungen durch</div>
            <div class="card-body">
                <div class="center-items">
                    <div class=" mb-3 center-items ">
                        <mat-form-field>
                            <mat-label>Töchter/Händler</mat-label>
                            <mat-select [(ngModel)]="selectedValue" required>
                                <mat-option>--</mat-option>
                                @for (t of toha; track toha) {
                                <mat-option [value]="t">{{t.viewValue}}</mat-option>
                                }
                            </mat-select>
                            @if (tohaControl.hasError('required')) {
                            <mat-error>Bitte auswählen</mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class=" mb-3 center-items ">
                        <mat-form-field>
                            <mat-label>Vertreter</mat-label>
                            <mat-select [(ngModel)]="selectedValue" required>
                                <mat-option>--</mat-option>
                                @for (t of toha; track toha) {
                                <mat-option [value]="t">{{t.viewValue}}</mat-option>
                                }
                            </mat-select>
                            @if (tohaControl.hasError('required')) {
                            <mat-error>Bitte auswählen</mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class=" mb-3">
                        <label>Ansprechpartner</label>
                        <input [(ngModel)]="inputCustomerRequirement.contact" type="text" class="form-control"
                            placeholder="Eingabe ... " aria-label="Username">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-header  text-white bg-danger">Angeforderter Technologe</div>
            <div class="card-body">
                <div class="center-items">
                    <div class=" mb-3 center-items ">
                        <mat-form-field>
                            <mat-label>Angeforderter Technologe</mat-label>
                            <mat-select [(ngModel)]="selectedValue" required>
                                <mat-option>--</mat-option>
                                @for (t of toha; track toha) {
                                <mat-option [value]="t">{{t.viewValue}}</mat-option>
                                }
                            </mat-select>
                            @if (tohaControl.hasError('required')) {
                            <mat-error>Bitte auswählen</mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class=" mb-3">
                        <label>Datum von</label>
                        <input [(ngModel)]="inputCustomerRequirement.startDate" type="date" class="form-control"
                            placeholder="Eingabe ... " aria-label="Username">
                    </div>
                    <div class=" mb-3">
                        <label>Datum bis</label>
                        <input [(ngModel)]="inputCustomerRequirement.endDate" type="date" class="form-control"
                            placeholder="Eingabe ... " aria-label="Username">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-header  text-white bg-danger">Reiseplanung</div>
            <div class="card-body">
                <div class="center-items">
                    <div class=" mb-3 center-items ">
                        <mat-form-field>
                            <mat-label>Flugbuchung</mat-label>
                            <mat-select [(ngModel)]="selectedValue" required>
                                <mat-option>--</mat-option>
                                <mat-option>Almi</mat-option>
                                <mat-option>Kunde</mat-option>
                            </mat-select>
                            @if (tohaControl.hasError('required')) {
                            <mat-error>Bitte auswählen</mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class=" mb-3 center-items ">
                        <mat-form-field>
                            <mat-label>Hotelbuchung</mat-label>
                            <mat-select [(ngModel)]="selectedValue" required>
                                <mat-option>--</mat-option>
                                <mat-option>Almi</mat-option>
                                <mat-option>Kunde</mat-option>
                            </mat-select>
                            @if (tohaControl.hasError('required')) {
                            <mat-error>Bitte auswählen</mat-error>
                            }
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-header  text-white bg-danger">sonstiges</div>
            <div class="card-body">
                <div class="center-items">
                    <div class=" mb-3">
                        <label>Sonstige Anmerkungen</label>
                        <input [(ngModel)]="inputCustomerRequirement.furtherNotes" type="text" class="form-control"
                            placeholder="Eingabe ... " aria-label="Username">
                    </div>
                    <div class=" mb-3">
                        <label>Interne Notiz</label>
                        <input [(ngModel)]="inputCustomerRequirement.internalNote" type="text" class="form-control"
                            placeholder="Eingabe ... " aria-label="Username">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<br>
<br>
<br>
<div class="centerHeader">
    <h1>Geplante Kundebesuche</h1>
    <button nz-button (click)="addRow()" nzType="primary">Neuer Kundenbesuch</button>
</div>
<hr>

<nz-table #editRowTable nzBordered [nzData]="inputCustomerRequirement.customerVisits!">
    <thead>
        <tr>
            <th>Name des Unternehmens</th>
            <th>Kundenummer</th>
            <th>Adresse</th>
            <th>Kontakt Person</th>
            <th>Datum des Besuchs</th>
            <th>Kundenbesuch</th>
            <th>Produktion Tonnen/Tag</th>
            <th>Bearbeiten/Entfernen</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let data of editRowTable.data" class="editable-row">
            <td>
                <div class="editable-cell" [hidden]="editId === data.id" (click)="startEdit(data.id)">
                    {{ data.companyName }}
                </div>
                <input [hidden]="editId !== data.id" type="text" nz-input [(ngModel)]="data.companyName" />
            </td>
            <td>
                <div class="editable-cell" [hidden]="editId === data.id" (click)="startEdit(data.id)">
                    {{ data.customerNr }}
                </div>
                <input [hidden]="editId !== data.id" type="text" nz-input [(ngModel)]="data.customerNr" />
            </td>
            <td>
                <div class="editable-cell" [hidden]="editId === data.id" (click)="startEdit(data.id)">
                    {{ data.address }}
                </div>
                <input [hidden]="editId !== data.id" type="text" nz-input [(ngModel)]="data.address" />
            </td>
            <td>
                <div class="editable-cell" [hidden]="editId === data.id" (click)="startEdit(data.id)">
                    {{ data.contactPerson }}
                </div>
                <input [hidden]="editId !== data.id" type="text" nz-input [(ngModel)]="data.contactPerson" />
            </td>
            <td>
                <div class="editable-cell" [hidden]="editId === data.id" (click)="startEdit(data.id)">
                    {{data.dateOfVisit}}
                </div>
                <input [hidden]="editId !== data.id" type="date" nz-input [(ngModel)]="data.dateOfVisit" />
            </td>
            <td class="multiple-select">
                <mat-select multiple placeholder="Auswählen . . . " (selectionChange)="selChange($event, data.id)">
                    <mat-option value="1">Vorstellung neuer Produkte</mat-option>
                    <mat-option value="2">Problemlösung - bestehende Produkten</mat-option>
                    <mat-option value="3">Rezepturoptimierung</mat-option>
                    <mat-option value="4">Musterproduktion</mat-option>
                    <mat-option value="5">Schulung</mat-option>
                </mat-select>
            </td>
            <td>
                <div class="editable-cell" [hidden]="editId === data.id" (click)="startEdit(data.id)">
                    {{data.productionAmount}}
                </div>
                <input [hidden]="editId !== data.id" type="text" nz-input [(ngModel)]="data.productionAmount" />
            </td>
            <td class="buttons">
                <button class="btn btn-success" (click)="startEdit(data.id)" [hidden]="editId === data.id">
                    <i class="fa fa-pencil" aria-hidden="true"></i>
                </button>
                <button class="btn btn-success" (click)="stopEdit()" [hidden]="editId !== data.id">
                    <i class="fa fa-save" aria-hidden="true"></i>
                </button>
                <button class="btn btn-danger" nz-popconfirm nzPopconfirmShowArrow="false"
                    nzPopconfirmTitle="Sind Sie sicher?" (nzOnConfirm)="deleteRow(data.id)">
                    <i class="fa fa-trash" aria-hidden="true"></i>
                </button>
            </td>
        </tr>
    </tbody>
</nz-table>